<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>ðŸ’– Will You Be My Valentine? ðŸ’–</title>
  <meta name="description" content="Romantic Valentine invitation â€“ Buttons outside letter, moving NO & growing YES.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Poppins:wght@300;400;600;700&family=Caveat:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
  <style>
    /* === RESET & BASE === */
    *,
    *::before,
    *::after { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      width: 100%; min-height: 100vh; overflow-x: hidden;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #fce4ec 0%, #f8bbd0 30%, #f3e5f5 60%, #fff9c4 100%);
      color: #4a2040;
      -webkit-tap-highlight-color: transparent;
      touch-action: pan-y pinch-zoom;
    }
    /* floating flowers (unchanged) */
    .flowers-bg {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; z-index: 0; overflow: hidden;
    }
    .flowers-bg .float-flower {
      position: absolute; opacity: 0.5; user-select: none; pointer-events: none;
      will-change: transform; font-size: clamp(20px, 8vw, 40px);
      animation: floatFlower linear infinite;
    }
    @keyframes floatFlower {
      0% { transform: translateY(110vh) rotate(0deg) scale(0.8); opacity: 0; }
      10% { opacity: 0.7; }
      90% { opacity: 0.7; }
      100% { transform: translateY(-10vh) rotate(360deg) scale(1); opacity: 0; }
    }
    /* === SCENE === */
    .scene {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      z-index: 5; transition: opacity 0.8s ease, visibility 0.8s ease; padding: 12px;
    }
    .scene.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
    /* envelope wrapper */
    .envelope-wrapper {
      display: flex; flex-direction: column; align-items: center; gap: min(20px, 4vw);
      animation: floatEnvelope 3s ease-in-out infinite; cursor: grab; user-select: none;
      width: 100%; max-width: 400px;
    }
    @keyframes floatEnvelope { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-10px);} }
    .envelope {
      width: min(360px, 82vw); height: calc(min(360px, 82vw) * 0.72);
      position: relative; perspective: 900px; filter: drop-shadow(0 8px 20px rgba(80,40,20,0.3));
      margin: 0 auto;
    }
    /* envelope layers (unchanged) */
    .envelope-back { position: absolute; top:0; left:0; width:100%; height:100%; background: linear-gradient(135deg, #f5e6d0 0%, #efe0c8 20%, #e8d5b5 40%, #f0e2cc 60%, #ece0c6 80%, #e5d4b0 100%); border-radius:6px; border:1px solid #c9b896; border-top:none; z-index:1; overflow:hidden; }
    .envelope-back::before { content:''; position:absolute; top:0; left:0; width:100%; height:100%; background: repeating-linear-gradient(0deg, transparent 0px, transparent 18px, rgba(160,120,60,0.03) 18px, rgba(160,120,60,0.03) 19px); }
    .envelope-front { position:absolute; bottom:0; left:0; width:100%; height:65%; background:linear-gradient(180deg, transparent, #e8d5b5 10%, #dcc9a3); clip-path:polygon(0 0, 50% 55%, 100% 0, 100% 100%, 0 100%); z-index:3; pointer-events:none; }
    .envelope-flap { position:absolute; top:0; left:0; width:100%; height:55%; background:linear-gradient(180deg, #dcc9a3, #e8d5b5, #d5c19d); clip-path:polygon(0 0, 50% 100%, 100% 0); z-index:4; transform-origin:top center; transition:transform 1.2s cubic-bezier(0.23,1,0.32,1); box-shadow:inset 0 5px 15px rgba(160,120,60,0.1); }
    .wax-seal { position:absolute; top:44%; left:50%; transform:translate(-50%,-50%); z-index:6; transition:all 0.6s cubic-bezier(0.23,1,0.32,1); }
    .wax-seal-heart { width:clamp(40px,15vw,58px); height:clamp(36px,13vw,52px); position:relative; animation:sealPulse 2s ease-in-out infinite; }
    .wax-seal-heart::before, .wax-seal-heart::after { content:''; position:absolute; top:0; width:clamp(20px,7vw,30px); height:clamp(34px,12vw,48px); border-radius:30px 30px 0 0; background:radial-gradient(circle at 40% 30%, #d32f2f, #b71c1c 50%, #8b0000); box-shadow:inset 0 3px 6px rgba(255,255,255,0.2), inset 0 -3px 6px rgba(0,0,0,0.15), 0 4px 12px rgba(139,0,0,0.5); }
    .wax-seal-heart::before { left:1px; transform:rotate(-45deg); transform-origin:bottom right; }
    .wax-seal-heart::after { right:1px; transform:rotate(45deg); transform-origin:bottom left; }
    .wax-seal-initial { position:absolute; top:50%; left:50%; transform:translate(-50%,-55%); font-family:'Dancing Script',cursive; font-size:clamp(16px,6vw,24px); color:rgba(255,220,220,0.7); text-shadow:0 1px 1px rgba(0,0,0,0.3); z-index:6; }
    @keyframes sealPulse { 0%,100%{transform:scale(1);} 50%{transform:scale(1.06);} }
    .letter-opener { position:absolute; top:44%; left:-70px; width:45px; height:5px; z-index:7; opacity:0; transform:translate(0,-50%) rotate(-12deg); pointer-events:none; }
    .opener-blade { width:100%; height:100%; background:linear-gradient(180deg,#e8e8e8,#aaa,#ccc); clip-path:polygon(0 50%, 85% 0, 100% 50%, 85% 100%); }
    .opener-handle { position:absolute; left:-20px; top:-5px; width:22px; height:14px; background:linear-gradient(180deg,#8d6e63,#5d4037); border-radius:3px 0 0 3px; }

    /* === LETTER (question only, no buttons inside) === */
    .letter-card {
      position: absolute; left: 5%; width: 90%; height: 98%;
      bottom: 0; border-radius: 4px 4px 0 0; z-index: 2; opacity: 0; pointer-events: none;
      box-shadow: 0 2px 10px rgba(80,40,20,0.15); overflow: hidden;
      transform-origin: bottom center; transform: translateY(10%) scaleY(0.4);
      transition: opacity 0.8s, transform 0.8s;
    }
    .envelope.phase-letter-pop .letter-question {
      animation: popAndUnfold 1.2s cubic-bezier(0.3,1.2,0.3,1) forwards;
      pointer-events: auto; z-index: 10;
    }
    @keyframes popAndUnfold {
      0% { opacity:0; transform:translateY(20%) scaleY(0.3); }
      40% { opacity:1; transform:translateY(-70%) scaleY(0.3); }
      100% { opacity:1; transform:translateY(-60%) scaleY(1); }
    }
    .letter-question { background: linear-gradient(180deg, #fffef5, #fdf8ec, #faf3e0); }
    .letter-question-inner {
      width: 100%; height: 100%;
      padding: 20px 10px;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      background: repeating-linear-gradient(transparent 0px, transparent 28px, rgba(180,160,130,0.15) 28px, rgba(180,160,130,0.15) 29px);
    }
    .letter-q-text {
      font-family: 'Caveat', cursive;
      font-size: clamp(18px, 5vw, 24px);
      font-weight: 700; color: #5d3a1a; text-align: center; line-height: 1.5;
      margin-bottom: 20px;
    }
    /* Dynamic message inside letter */
    .letter-dynamic-msg {
      font-family: 'Caveat', cursive; font-size: clamp(16px, 4.5vw, 22px);
      color: #ad1457; min-height: 40px; text-align: center; margin-top: 10px;
      font-weight: 600;
    }

    /* === BOTTOM BUTTONS (outside envelope, fixed) === */
    .bottom-buttons {
      position: fixed; bottom: 20px; left: 0; width: 100%;
      display: flex; justify-content: center; gap: 20px;
      z-index: 30; pointer-events: none;
    }
    .bottom-buttons .btn {
      pointer-events: auto;
      border: none; border-radius: 50px; font-family: 'Poppins', sans-serif; font-weight: 600;
      cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.2); outline: none;
      font-size: clamp(14px, 4vw, 18px);
      transition: transform 0.25s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      will-change: transform;
    }
    .btn-yes {
      background: linear-gradient(135deg, #e91e63, #f06292); color: white;
      padding: clamp(10px, 3vw, 14px) clamp(20px, 6vw, 36px);
      transform: scale(1);
    }
    .btn-yes.pump {
      animation: pump 0.3s ease-in-out;
    }
    @keyframes pump {
      0% { transform: scale(var(--yes-scale, 1)); }
      50% { transform: scale(calc(var(--yes-scale, 1) * 1.2)); }
      100% { transform: scale(var(--yes-scale, 1)); }
    }
    .btn-no {
      background: linear-gradient(135deg, #9e9e9e, #bdbdbd); color: white;
      padding: clamp(8px, 2.5vw, 12px) clamp(16px, 5vw, 26px);
      transform: scale(1);
      min-width: 70px; text-align: center;
      border-radius: 50px; /* rounded edges */
      border: none;
      font-family: 'Poppins', sans-serif; font-weight: 600;
      cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.2); outline: none;
      transition: left 0.08s linear, top 0.08s linear, transform 0.2s ease;
      will-change: transform, left, top;
      position: fixed;
      z-index: 31;
    }
    .btn-no.hidden, .bottom-buttons.hidden {
      display: none;
    }

    /* swipe hint */
    .swipe-hint {
      font-family: 'Poppins', sans-serif; font-size: clamp(14px, 4vw, 18px); color: #8d6e63;
      animation: fadeInOut 2.5s ease-in-out infinite; text-align: center; margin-top: 10px;
      background: rgba(255,255,255,0.5); backdrop-filter: blur(4px); padding: 8px 18px; border-radius: 40px;
    }
    @keyframes fadeInOut { 0%,100%{opacity:0.6;} 50%{opacity:1;} }
    .swipe-arrow { font-size:1.4em; animation:swipeArrow 1.5s ease-in-out infinite; display:inline-block; }
    @keyframes swipeArrow { 0%,100%{transform:translateX(0);} 50%{transform:translateX(8px);} }

    /* === CELEBRATION OVERLAY === */
    .celebration-overlay {
      position: fixed; top:0; left:0; width:100%; height:100%; display:flex; flex-direction:column;
      align-items:center; justify-content:center; padding:20px; z-index:20; pointer-events:none;
      opacity:0; transition:opacity 0.8s ease; background:linear-gradient(135deg, #fce4ec 0%, #f8bbd0 25%, #f3e5f5 50%, #e8eaf6 75%, #fff9c4 100%); overflow:hidden;
    }
    .celebration-overlay.active { opacity:1; pointer-events:auto; }
    .celebration-title { font-family:'Dancing Script',cursive; font-size:clamp(32px,10vw,64px); color:#c2185b; text-shadow:0 3px 15px rgba(194,24,91,0.3); animation:celebratePulse 2s ease-in-out infinite; text-align:center; line-height:1.2; margin-bottom:0.1em; }
    .celebration-subtitle { font-family:'Dancing Script',cursive; font-size:clamp(20px,5vw,36px); color:#ad1457; margin-bottom:10px; }
    .bouquet { display:flex; flex-wrap:wrap; align-items:flex-end; justify-content:center; gap:6px 10px; margin:10px 0; }
    .bouquet-flower { display:inline-flex; flex-direction:column; align-items:center; animation:flowerPop 0.6s ease forwards; opacity:0; }
    .bouquet-flower .flower-icon { font-size:clamp(32px,8vw,48px); }
    @keyframes flowerPop { from { opacity:0; transform:scale(0) rotate(-20deg); } to { opacity:1; transform:scale(1) rotate(0); } }
    .celebration-poem {
      font-family: 'Caveat', cursive; font-size: clamp(18px, 4.5vw, 24px);
      color: #5d3a1a; text-align: center; white-space: pre-line;
      max-width: 90vw; margin-top: 10px; line-height: 1.5;
      max-height: 60vh; /* increased to show more content */
      overflow-y: auto;  /* scroll if needed, with visible bar */
      padding: 0 15px;
    }
    /* scrollbar styling (optional) */
    .celebration-poem::-webkit-scrollbar { width: 6px; }
    .celebration-poem::-webkit-scrollbar-thumb { background: #c2185b; border-radius: 10px; }
    @keyframes celebratePulse { 0%,100%{transform:scale(1);} 50%{transform:scale(1.05);} }
    .sparkle-overlay { position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:0; }
    .sparkle-overlay .sparkle { position:absolute; width:4px; height:4px; background:#fff; border-radius:50%; animation:twinkle 2s ease-in-out infinite; }
    @keyframes twinkle { 0%,100%{opacity:0; transform:scale(0);} 50%{opacity:1; transform:scale(1);} }

    @media (max-width: 480px) {
      .envelope { width: 88vw; height: calc(88vw * 0.72); }
      .letter-q-text { font-size: 20px; }
    }
  </style>
</head>
<body>
  <div class="flowers-bg" id="flowersBg"></div>

  <!-- ENVELOPE SCENE -->
  <div class="scene" id="envelopeScene">
    <div class="envelope-wrapper" id="envelopeWrapper">
      <div class="envelope" id="envelope">
        <div class="envelope-back"></div>
        <div class="envelope-flap"></div>
        <div class="envelope-front"></div>
        <div class="wax-seal"><div class="wax-seal-heart"></div><span class="wax-seal-initial">S</span></div>
        <div class="letter-opener"><div class="opener-handle"></div><div class="opener-blade"></div></div>

        <!-- LETTER with question and dynamic message only -->
        <div class="letter-card letter-question" id="letterQuestion">
          <div class="letter-question-inner">
            <div class="letter-q-text">Will you be<br>Syed Abubaker Ahmed's<br>Valentine for 2026<br>and forever? ðŸ’•</div>
            <div class="letter-dynamic-msg" id="dynamicMessage"></div>
          </div>
        </div>
      </div>
      <p class="swipe-hint" id="swipeHint">Swipe to open <span class="swipe-arrow">ðŸ‘‰</span></p>
    </div>
  </div>

  <!-- BOTTOM BUTTONS (initially hidden) -->
  <div class="bottom-buttons hidden" id="bottomButtons">
    <button class="btn btn-yes" id="btnYes">ðŸ’– YES</button>
  </div>
  <button class="btn-no hidden" id="btnNo">ðŸ’” NO</button>

  <!-- CELEBRATION OVERLAY -->
  <div class="celebration-overlay" id="celebrationOverlay">
    <h1 class="celebration-title">She said YES ðŸ’–</h1>
    <p class="celebration-subtitle">Congratulations to us âœ¨</p>
    <div class="bouquet" id="bouquet"></div>
    <div class="celebration-poem" id="celebrationPoem"></div>
  </div>

  <div class="sparkle-overlay hidden" id="sparkleOverlay"></div>

  <script>
    (function() {
      let currentState = 'closed'; // closed, opening, question, celebration
      let noClickCount = 0;
      let yesScale = 1.0;
      let noScale = 1.0;
      
      const noMessagesSeq = [
        "wrong answer try again",
        "WRONG!",
        "Arre why are you doing this",
        "I am sorry it wasn't a question you had a choice to now click yes khamusi se"
      ];

      const envelopeScene = document.getElementById('envelopeScene');
      const envelope = document.getElementById('envelope');
      const envelopeWrapper = document.getElementById('envelopeWrapper');
      const btnYes = document.getElementById('btnYes');
      const btnNo = document.getElementById('btnNo');
      const bottomButtons = document.getElementById('bottomButtons');
      const dynamicMessage = document.getElementById('dynamicMessage');
      const sparkleOverlay = document.getElementById('sparkleOverlay');
      const celebrationOverlay = document.getElementById('celebrationOverlay');
      const celebrationPoem = document.getElementById('celebrationPoem');
      const swipeHint = document.getElementById('swipeHint');
      const bouquetDiv = document.getElementById('bouquet');

      // floating flowers
      const flowersBg = document.getElementById('flowersBg');
      const uniqueFlowers = ['ðŸŒ·', 'ðŸŒ»', 'ðŸŒ¹', 'ðŸŒ¸', 'ðŸª»', 'ðŸŒ¼', 'ðŸ’®', 'ðŸŒº'];
      function initFloatingFlowers() {
        uniqueFlowers.forEach((emoji) => {
          const flower = document.createElement('span');
          flower.className = 'float-flower';
          flower.textContent = emoji;
          flower.style.left = Math.random() * 90 + '%';
          const size = window.innerWidth < 480 ? (20 + Math.random() * 25) : (24 + Math.random() * 30);
          flower.style.fontSize = size + 'px';
          const duration = 15 + Math.random() * 20;
          flower.style.animationDuration = duration + 's';
          flower.style.animationDelay = -(Math.random() * duration) + 's';
          flowersBg.appendChild(flower);
        });
      }
      initFloatingFlowers();

      // swipe detection
      let swipeStartX = 0, swipeStartY = 0, isSwiping = false;
      function handleSwipeStart(x, y) {
        if (currentState === 'closed') { swipeStartX = x; swipeStartY = y; isSwiping = true; envelopeWrapper.style.cursor = 'grabbing'; }
      }
      function handleSwipeEnd(x, y) {
        if (!isSwiping) return;
        isSwiping = false;
        envelopeWrapper.style.cursor = 'grab';
        const dx = x - swipeStartX;
        const dy = y - swipeStartY;
        const distance = Math.sqrt(dx*dx + dy*dy);
        if (currentState === 'closed' && distance > 40) openEnvelope();
      }
      envelopeWrapper.addEventListener('touchstart', (e) => { handleSwipeStart(e.touches[0].clientX, e.touches[0].clientY); }, { passive: true });
      envelopeWrapper.addEventListener('touchend', (e) => { handleSwipeEnd(e.changedTouches[0].clientX, e.changedTouches[0].clientY); }, { passive: true });
      envelopeWrapper.addEventListener('mousedown', (e) => handleSwipeStart(e.clientX, e.clientY));
      document.addEventListener('mouseup', (e) => handleSwipeEnd(e.clientX, e.clientY));

      // Helper: position NO button at bottom center initially (next to YES)
      function positionNoButtonAtBottom() {
        btnNo.classList.remove('hidden');
        btnNo.style.position = 'fixed';
        // Wait for YES button to be rendered
        setTimeout(() => {
          const yesRect = btnYes.getBoundingClientRect();
          const gap = 20;
          const yesLeft = (window.innerWidth/2) - (yesRect.width/2);
          const noLeft = yesLeft + yesRect.width + gap;
          btnNo.style.left = noLeft + 'px';
          btnNo.style.top = 'auto';
          btnNo.style.bottom = '20px';
          btnNo.style.transform = `scale(${noScale})`;
        }, 50);
      }

      // Helper: move NO button randomly
      function moveNoButtonRandomly() {
        const viewportW = window.innerWidth;
        const viewportH = window.innerHeight;
        const btnW = btnNo.offsetWidth;
        const btnH = btnNo.offsetHeight;
        const randomX = Math.min(viewportW - btnW - 10, Math.max(10, Math.random() * (viewportW - btnW - 20)));
        const randomY = Math.min(viewportH - btnH - 10, Math.max(10, Math.random() * (viewportH - btnH - 20)));
        btnNo.style.left = randomX + 'px';
        btnNo.style.top = randomY + 'px';
        btnNo.style.bottom = 'auto';
        btnNo.style.transform = `scale(${noScale})`;
      }

      // Open envelope
      function openEnvelope() {
        if (currentState !== 'closed') return;
        currentState = 'opening';
        envelopeWrapper.style.animation = 'none';
        swipeHint.style.opacity = '0';
        swipeHint.style.display = 'none';

        playOpenSound();

        envelope.classList.add('phase-knife');
        setTimeout(() => envelope.classList.add('phase-seal-break'), 600);
        setTimeout(() => envelope.classList.add('phase-flap-open'), 1300);
        setTimeout(() => {
          envelope.classList.add('phase-letter-pop');
          currentState = 'question';

          // Reset scales and message
          yesScale = 1.0;
          noScale = 1.0;
          btnYes.style.transform = `scale(${yesScale})`;
          btnNo.style.transform = `scale(${noScale})`;
          dynamicMessage.innerHTML = '';
          noClickCount = 0;

          bottomButtons.classList.remove('hidden');
          btnNo.classList.remove('hidden');
          
          positionNoButtonAtBottom();
        }, 2000);
      }

      // Pump YES
      function pumpYesButton() {
        btnYes.style.setProperty('--yes-scale', yesScale);
        btnYes.classList.add('pump');
        setTimeout(() => {
          btnYes.classList.remove('pump');
        }, 300);
      }

      // NO button click handler
      function handleNoClick(e) {
        e.preventDefault();
        if (currentState !== 'question') return;
        
        noClickCount++;
        
        if (noClickCount <= noMessagesSeq.length) {
          dynamicMessage.textContent = noMessagesSeq[noClickCount - 1];
        }
        
        if (noClickCount >= noMessagesSeq.length) {
          btnNo.style.display = 'none';
          yesScale = 3.0;
          btnYes.style.transform = `scale(${yesScale})`;
          pumpYesButton();
          btnNo.removeEventListener('click', handleNoClick);
          btnNo.removeEventListener('touchstart', handleNoClick);
          return;
        }
        
        yesScale = Math.min(yesScale + 0.2, 2.8);
        noScale = Math.max(noScale - 0.15, 0.2);
        
        btnYes.style.transform = `scale(${yesScale})`;
        btnNo.style.transform = `scale(${noScale})`;
        
        pumpYesButton();
        moveNoButtonRandomly();
      }

      btnNo.addEventListener('click', handleNoClick);
      btnNo.addEventListener('touchstart', handleNoClick, { passive: false });

      // YES button click
      btnYes.addEventListener('click', () => {
        if (currentState !== 'question') return;
        currentState = 'celebration';

        envelopeScene.classList.add('hidden');
        bottomButtons.classList.add('hidden');
        btnNo.classList.add('hidden');

        loadPoemIntoOverlay();
        triggerCelebration();
      });

      function triggerCelebration() {
        celebrationOverlay.classList.add('active');
        buildBouquet();
        fireConfetti();
        playCelebrationSound();
        showSparkles();
        document.body.style.background = 'linear-gradient(135deg, #fce4ec 0%, #f8bbd0 25%, #f3e5f5 50%, #e8eaf6 75%, #fff9c4 100%)';
      }

      function buildBouquet() {
        bouquetDiv.innerHTML = '';
        const flowers = ['ðŸŒ·', 'ðŸŒ»', 'ðŸŒ¹', 'ðŸŒ¸', 'ðŸª»', 'ðŸŒ¼', 'ðŸŒ¼', 'ðŸ’®', 'ðŸŒº'];
        flowers.forEach((emoji, i) => {
          const f = document.createElement('div');
          f.className = 'bouquet-flower';
          f.style.animationDelay = (0.1 + i*0.1)+'s';
          f.style.animationFillMode = 'forwards';
          f.innerHTML = `<span class="flower-icon">${emoji}</span>`;
          bouquetDiv.appendChild(f);
        });
        const ribbon = document.createElement('div');
        ribbon.textContent = 'ðŸŽ€';
        ribbon.style.fontSize = 'clamp(24px, 8vw, 40px)';
        bouquetDiv.appendChild(ribbon);
      }

      function fireConfetti() {
        const defaults = { spread: 360, ticks: 100, gravity: 0.5, decay: 0.94, startVelocity: 30, colors: ['#e91e63','#f48fb1','#ff80ab','#ff4081','#f50057','#c2185b','#fff','#ffeb3b'] };
        function burst() { confetti({ ...defaults, particleCount: 30, scalar: 1.2, shapes: ['circle','square'], origin: { x: Math.random(), y: Math.random()*0.4 } }); }
        burst(); setTimeout(burst,250); setTimeout(burst,500); setTimeout(burst,1000); setTimeout(burst,1500); setTimeout(burst,2500);
      }

      function playOpenSound() {
        try {
          const ctx = new (window.AudioContext || window.webkitAudioContext)();
          const bufLen = ctx.sampleRate * 0.4;
          const buf = ctx.createBuffer(1, bufLen, ctx.sampleRate);
          const data = buf.getChannelData(0);
          for (let i=0; i<bufLen; i++) { const t=i/ctx.sampleRate; data[i] = (Math.random()*2-1) * Math.exp(-t*12)*0.2; }
          const src = ctx.createBufferSource(); src.buffer = buf;
          const filter = ctx.createBiquadFilter(); filter.type='highpass'; filter.frequency.value=2000;
          const gain = ctx.createGain(); gain.gain.value=0.2;
          src.connect(filter); filter.connect(gain); gain.connect(ctx.destination);
          src.start(ctx.currentTime+0.3);
        } catch(e){}
      }

      function playCelebrationSound() {
        try {
          const ctx = new (window.AudioContext || window.webkitAudioContext)();
          const now = ctx.currentTime;
          const noiseDur=2.5; const bufSize=ctx.sampleRate*noiseDur;
          const noiseBuf=ctx.createBuffer(2,bufSize,ctx.sampleRate);
          for(let ch=0;ch<2;ch++){ const d=noiseBuf.getChannelData(ch); for(let i=0;i<bufSize;i++){ const t=i/ctx.sampleRate; const env=Math.min(t*8,1)*Math.max(1-(t-1)/1.5,0); d[i]=(Math.random()*2-1)*env*0.5; } }
          const nSrc=ctx.createBufferSource(); nSrc.buffer=noiseBuf;
          const bpf=ctx.createBiquadFilter(); bpf.type='bandpass'; bpf.frequency.value=1200; bpf.Q.value=0.8;
          const nGain=ctx.createGain(); nGain.gain.setValueAtTime(0,now); nGain.gain.linearRampToValueAtTime(0.3,now+0.2); nGain.gain.exponentialRampToValueAtTime(0.01,now+noiseDur);
          nSrc.connect(bpf); bpf.connect(nGain); nGain.connect(ctx.destination);
          nSrc.start(now); nSrc.stop(now+noiseDur);
          const note=(freq,start,dur,vol=0.1)=>{ const o=ctx.createOscillator(); const g=ctx.createGain(); o.type='triangle'; o.frequency.value=freq; g.gain.setValueAtTime(vol,now+start); g.gain.exponentialRampToValueAtTime(0.005,now+start+dur); o.connect(g); g.connect(ctx.destination); o.start(now+start); o.stop(now+start+dur); };
          note(523.25,0.1,0.2); note(659.25,0.3,0.2); note(783.99,0.5,0.2); note(1046.50,0.7,0.4); note(783.99,1.2,0.15); note(880.00,1.4,0.15); note(1046.50,1.6,0.6);
        } catch(e){}
      }

      function showSparkles() {
        sparkleOverlay.classList.remove('hidden');
        for (let i=0;i<24;i++) {
          const s=document.createElement('div'); s.className='sparkle';
          s.style.left=Math.random()*100+'%'; s.style.top=Math.random()*100+'%';
          s.style.animationDelay=Math.random()*3+'s'; s.style.animationDuration=(1.5+Math.random()*2)+'s';
          s.style.width=(3+Math.random()*4)+'px'; s.style.height=s.style.width;
          s.style.background=['#fff','#f8bbd0','#ffeb3b','#e1bee7'][Math.floor(Math.random()*4)];
          sparkleOverlay.appendChild(s);
        }
      }

      const fallbackPoem = "Every moment with you is a gift,\nEvery smile of yours, my heart does lift.\nIn this world so vast and wide,\nYou're forever my love, my pride.\n\nâ€” With all my love, always and forever ðŸ’–";
      function loadPoemIntoOverlay() {
        fetch('poem.txt')
          .then(r => r.ok ? r.text() : fallbackPoem)
          .then(text => { celebrationPoem.textContent = text; })
          .catch(() => { celebrationPoem.textContent = fallbackPoem; });
      }
      loadPoemIntoOverlay();
    })();
  </script>
</body>
</html>
